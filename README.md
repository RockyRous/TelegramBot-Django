

# TelegramBot-Django

## Описание задачи

### Задание

Необходимо разработать Telegram-бота с основными функциями.
<img width="2117" alt="Тестовое задание (1)" src="https://github.com/user-attachments/assets/5556edcd-758b-461f-ae64-e0458b237e8b">

### Дополнительные требования

- Использовать библиотеку **Aiogram-3** для реализации функционала бота.
- Админ-панель на базе Django и Telegram-бот должны быть оформлены как два независимых проекта, взаимодействующих через общую базу данных без необходимости создания API.
- В качестве СУБД следует использовать **PostgreSQL**. Все запросы к базе данных должны быть асинхронными, что можно реализовать с помощью ORM Django.
- Для сборки и запуска проекта используется **Docker**.
- В проекте необходимо реализовать ведение логов с сохранением их на сервере для последующего анализа.
- Для управления конфиденциальными данными использовать файл **.env**, что исключает прямое включение данных в код.

## Архитектура проекта

Проект состоит из двух микросервисов, которые взаимодействуют друг с другом через общую базу данных PostgreSQL:

1. **Telegram Bot** — реализован с использованием библиотеки Aiogram-3, отвечает за взаимодействие с пользователями.
2. **Admin Panel (Django)** — админ-панель для управления данными и пользователями, хранит данные в той же базе PostgreSQL.

Микросервисы работают независимо, взаимодействуя с базой данных напрямую. Для запуска обоих сервисов используется **Docker Compose**, обеспечивающий изоляцию и удобство развертывания.

## Установка и запуск проекта

Чтобы установить проект на локальной машине, выполните следующие шаги:

1. Склонируйте репозиторий:
   ```bash
   git clone <URL вашего репозитория>
   cd <название репозитория>
   ```

2. Убедитесь, что Docker установлен на вашем компьютере.

3. Следуйте инструкции в файле [run.md](./run.md). для запуска проекта в Docker-контейнерах.

## Описание микросервисов

### Telegram Bot

Сервис Telegram Bot разработан на основе библиотеки **Aiogram-3** и автоматически запускается в контейнере. Основное назначение бота — предоставление пользователю функций корзины, каталога товаров, а также возможности оплаты и взаимодействия с администратором через рассылки. Все основные функции реализованы через асинхронные обработчики и команды.

#### Файловая структура сервиса

- **Dockerfile** — конфигурационный файл для сборки контейнера с ботом. Описывает необходимые для работы зависимости и автоматический запуск `main.py` при старте контейнера.

- **buttons.py** — файл, содержащий реализацию инлайн-кнопок для интерфейса бота. Кнопки используются для навигации и взаимодействия с пользователем, включая переходы между разделами, добавление в корзину и оплату.

- **cart.py** — модуль для обработки команд, связанных с корзиной пользователя. Управляет добавлением, удалением и просмотром товаров в корзине, взаимодействует с базой данных через asyncpg.

- **catalog.py** — модуль, аналогичный `cart.py`, но отвечающий за работу с каталогом товаров. Реализует функции просмотра, поиска и фильтрации товаров, доступных для добавления в корзину.

- **config.py** — файл конфигурации, где задаются переменные окружения для работы бота. Перед началом работы необходимо заполнить этот файл, указав, ключевые параметры.

- **faq.py** — модуль для обработки пользовательских запросов, связанных с часто задаваемыми вопросами (FAQ). Реализует команды, которые предоставляют справочную информацию пользователям.

- **main.py** — основной файл запуска бота. Содержит:
  - Инициализацию и настройку бота,
  - Регистрацию команд,
  - Логику фоновой задачи для рассылок.
  
- **newsletter.py** — модуль для управления рассылками.

- **payments.py** — модуль для работы с платёжной системой. Обеспечивает функционал оплаты товаров, интегрирован с внешним платёжным шлюзом Юкасса.

- **requirements.txt** — файл со списком зависимостей. Содержит версии библиотек, которые автоматически устанавливаются при сборке контейнера.

- **router.py** — файл для регистрации и маршрутизации всех хендлеров, то есть функций-обработчиков команд. Обеспечивает структурированную организацию команд и функций, обрабатываемых ботом.

#### Основные функции бота

Telegram Bot предоставляет следующие функции:
- **Проверка подписки** — Проверяет подписан ли пользователь на указаные в config.py группы или каналы.
- **Каталог товаров** — позволяет пользователям просматривать и выбирать товары из каталога.
- **Корзина** — позволяет добавлять, удалять и просматривать товары, которые пользователь намеревается приобрести.
- **Оплата** — реализована интеграция с платёжной системой для безопасного проведения транзакций.
- **FAQ** — раздел с часто задаваемыми вопросами для предоставления справочной информации.
- **Рассылки** — администратор может отправлять уведомления и новости пользователям через рассылку (создается в админ панели Django).

#### Запуск и настройка

Для запуска бота используется `Dockerfile`, который автоматически выполняет сборку и запускает `main.py` при старте контейнера. Убедитесь, что все переменные окружения указаны в файле `.env`, и следуйте инструкции в файле `run.md` для успешного запуска контейнера.

---

### Admin Panel (Django)

Сервис **Admin Panel** предоставляет административный интерфейс для управления данными приложения и служит для настройки и мониторинга основных функций бота. Реализован на основе **Django** и построен с использованием приложения `store`, которое содержит все модели данных проекта. Веб-интерфейс Django-админки позволяет администратору взаимодействовать с товарами, категориями, заказами и рассылками. Доступ к админ-панели осуществляется по адресу: `http://localhost:8000/admin`.

#### Файловая структура сервиса

- **store** — основное приложение, в котором описаны все модели данных и представления.
  - **Модели**: определяют структуру данных для товаров, категорий, заказов, пользователей и рассылок.
  - **Представления**: реализуют логику отображения данных и обработки запросов.
  - **Страница заказов**: единственная настраиваемая страница, которая отображает таблицу с заказами и доступна по адресу `http://localhost:8000/`. Она предоставляет администратору удобный интерфейс для просмотра заказов пользователей.

#### Команды и настройки

В папке `django_admin` находится файл `README.md`, который описывает ключевые команды для работы с проектом, включая:
- **Миграции базы данных** — для создания и обновления таблиц в базе.
- **Создание суперпользователя** — для доступа к админ-панели.

Для создания суперпользователя, выполнения миграций и других административных задач следуйте инструкциям, описанным в `README.md` Django.

#### Запуск и настройка

Для запуска панели используется Docker. Сервис автоматически запускается при старте контейнера и доступен по адресу `http://localhost:8000`. Перед запуском убедитесь, что все переменные окружения указаны в файле `.env`, и следуйте инструкции в файле `run.md` для корректного запуска контейнера и взаимодействия с базой данных PostgreSQL.

## Конфигурация

Проект использует файл `.env` для хранения конфиденциальных данных и переменных окружения. Убедитесь, что файл `.env` создан и содержит ваши переменные

## Лицензия

Этот проект распространяется на условиях лицензии **Creative Commons Attribution-NonCommercial 4.0 International**. Полный текст лицензии доступен в файле [LICENSE.md](./LICENSE.md).
```

